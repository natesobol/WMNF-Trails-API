<!--
  WMNF Trail Explorer

  This HTML document builds a simple, responsive web application that allows users to browse
  hiking trails in New Hampshire's White Mountain National Forest (WMNF).  It displays a
  searchable, sortable list of trails alongside an interactive Leaflet map.  When a user
  selects a trail from the list, the map pans/zooms to the trail and highlights it.  The
  layout adapts gracefully between desktop and mobile screen sizes using CSS flexbox and
  media queries.

  For Wix embedding: This version uses GitHub's raw content URL to load the GeoJSON file.
  No DOCTYPE or full HTML structure is needed for Wix embeds. The Leaflet libraries are
  loaded via CDN. This works across all deployment contexts (GitHub Pages, Wix, etc).
-->
<link
  rel="stylesheet"
  href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
  crossorigin=""
/>
  <style>
    * {
      box-sizing: border-box;
    }

    /* Dark theme color palette */
    :root {
      --bg-primary: #1a1d23;
      --bg-secondary: #25282f;
      --bg-tertiary: #2d3039;
      --border-color: #3d4048;
      --text-primary: #e8e9eb;
      --text-secondary: #a0a3a8;
      --accent-blue: #4a9eff;
      --accent-blue-dark: #2d7dd8;
      --accent-red: #ff6b6b;
      --success-green: #51cf66;
      --hover-bg: #33373f;
    }

    html, body {
      height: 100%;
      margin: 0;
      padding: 0;
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
      background-color: var(--bg-primary);
      color: var(--text-primary);
    }

    /* Root container for the app */
    #app {
      display: flex;
      flex-direction: row;
      height: 100%;
      gap: 0;
    }

    /* Sidebar holds the search/sort controls and the list of trails */
    #sidebar {
      width: 32%;
      min-width: 300px;
      max-width: 450px;
      background-color: var(--bg-secondary);
      border-right: 1px solid var(--border-color);
      display: flex;
      flex-direction: column;
      overflow: hidden;
    }

    /* Header section with title */
    .sidebar-header {
      padding: 1.5rem;
      border-bottom: 1px solid var(--border-color);
      background-color: var(--bg-primary);
    }

    .sidebar-header h1 {
      margin: 0;
      font-size: 1.5rem;
      font-weight: 600;
      color: var(--text-primary);
      display: flex;
      align-items: center;
      gap: 0.5rem;
    }

    .sidebar-header p {
      margin: 0.5rem 0 0 0;
      font-size: 0.85rem;
      color: var(--text-secondary);
    }

    /* Controls container */
    .controls {
      padding: 1rem 1.5rem;
      border-bottom: 1px solid var(--border-color);
      display: flex;
      flex-direction: column;
      gap: 0.75rem;
      background-color: var(--bg-secondary);
    }

    .controls input[type="text"],
    .controls select {
      width: 100%;
      padding: 0.75rem;
      background-color: var(--bg-tertiary);
      border: 1px solid var(--border-color);
      border-radius: 6px;
      font-size: 0.95rem;
      color: var(--text-primary);
      transition: all 0.2s ease;
    }

    .controls input[type="text"]::placeholder {
      color: var(--text-secondary);
    }

    .controls input[type="text"]:focus,
    .controls select:focus {
      outline: none;
      border-color: var(--accent-blue);
      background-color: var(--bg-tertiary);
      box-shadow: 0 0 0 3px rgba(74, 158, 255, 0.1);
    }

    .controls select {
      cursor: pointer;
      appearance: none;
      background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='12' height='8' viewBox='0 0 12 8'%3E%3Cpath fill='%23a0a3a8' d='M1 1l5 5 5-5'/%3E%3C/svg%3E");
      background-repeat: no-repeat;
      background-position: right 0.75rem center;
      padding-right: 2.5rem;
    }

    /* Trail list container */
    .trail-list-container {
      flex: 1;
      overflow-y: auto;
      overflow-x: hidden;
    }

    .trail-list-container::-webkit-scrollbar {
      width: 8px;
    }

    .trail-list-container::-webkit-scrollbar-track {
      background: transparent;
    }

    .trail-list-container::-webkit-scrollbar-thumb {
      background: var(--border-color);
      border-radius: 4px;
    }

    .trail-list-container::-webkit-scrollbar-thumb:hover {
      background: var(--text-secondary);
    }

    /* Trail list styles */
    #trailList {
      list-style: none;
      padding: 0.5rem;
      margin: 0;
      display: flex;
      flex-direction: column;
      gap: 0.5rem;
    }

    #trailList li {
      padding: 1rem;
      background-color: var(--bg-tertiary);
      border: 1px solid var(--border-color);
      border-radius: 6px;
      cursor: pointer;
      transition: all 0.2s ease;
      font-size: 0.95rem;
      color: var(--text-primary);
      user-select: none;
    }

    #trailList li:hover {
      background-color: var(--hover-bg);
      border-color: var(--accent-blue);
      transform: translateX(4px);
    }

    #trailList li.active {
      background: linear-gradient(135deg, var(--accent-blue) 0%, var(--accent-blue-dark) 100%);
      border-color: var(--accent-blue);
      font-weight: 600;
      box-shadow: 0 4px 12px rgba(74, 158, 255, 0.25);
      color: white;
    }

    /* Empty state message */
    .empty-state {
      padding: 2rem 1.5rem;
      text-align: center;
      color: var(--text-secondary);
      font-size: 0.95rem;
    }

    /* Map container */
    #map {
      flex: 1;
      background-color: #2d2d2d;
    }

    /* Leaflet customization */
    .leaflet-control-container {
      font-family: inherit;
    }

    .leaflet-control {
      background-color: var(--bg-secondary);
      border: 1px solid var(--border-color);
      border-radius: 6px;
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.3);
    }

    .leaflet-control-zoom-in,
    .leaflet-control-zoom-out {
      color: var(--text-primary);
      background-color: var(--bg-tertiary);
      border-bottom: 1px solid var(--border-color);
    }

    .leaflet-control-zoom-in:hover,
    .leaflet-control-zoom-out:hover {
      background-color: var(--hover-bg);
      color: var(--accent-blue);
    }

    .leaflet-popup-content-wrapper {
      background-color: var(--bg-secondary);
      border: 1px solid var(--border-color);
      border-radius: 6px;
      box-shadow: 0 2px 12px rgba(0, 0, 0, 0.4);
    }

    .leaflet-popup-content {
      color: var(--text-primary);
      margin: 0;
    }

    .leaflet-popup-tip {
      background-color: var(--bg-secondary);
      border-color: var(--border-color);
    }

    /* Responsive adjustments for smaller screens */
    @media (max-width: 1024px) {
      #sidebar {
        width: 35%;
        min-width: 320px;
      }
    }

    @media (max-width: 768px) {
      #app {
        flex-direction: column;
      }
      #sidebar {
        width: 100%;
        max-width: none;
        height: 40%;
        border-right: none;
        border-bottom: 1px solid var(--border-color);
      }
      #map {
        height: 60%;
      }
    }
  </style>
</head>

<body>
  <div id="app">
    <aside id="sidebar">
      <!-- Sidebar Header -->
      <div class="sidebar-header">
        <h1>üèîÔ∏è WMNF Trails</h1>
        <p>White Mountain National Forest</p>
      </div>

      <!-- Search and sort controls -->
      <div class="controls">
        <input type="text" id="searchInput" placeholder="Search trails‚Ä¶" />
        <select id="sortSelect">
          <option value="az">Sort A ‚Üí Z</option>
          <option value="za">Sort Z ‚Üí A</option>
        </select>
      </div>

      <!-- Trail list container -->
      <div class="trail-list-container">
        <ul id="trailList"></ul>
      </div>
    </aside>
    <!-- Map container -->
    <div id="map"></div>
  </div>

  <!-- Include Leaflet JS library.  Leaflet provides map rendering and helper
       functions for working with GeoJSON.  The integrity hash ensures the
       downloaded script hasn't been tampered with. -->
  <script
    src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"
    crossorigin=""
  ></script>
  <script>
    (async function() {
      // Set a rough center over the WMNF.  The map will re‚Äëcenter when a trail
      // is selected.  Adjust these coordinates to your preferred initial view.
      const defaultCenter = [44.05, -71.35];
      const defaultZoom = 8;

      // Create the map.  The `L.map` function takes the id of the map container.
      const map = L.map('map').setView(defaultCenter, defaultZoom);

      // Add a basic OpenStreetMap tile layer.  You can replace this with other
      // providers such as Mapbox or Stamen if you require different styling.
      L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
        attribution:
          '&copy; <a href="https://www.openstreetmap.org/">OpenStreetMap</a> contributors',
        maxZoom: 19
      }).addTo(map);

      // Containers for the trail data.  `trailLayers` maps trail names to their
      // Leaflet layer and feature information.  `trailNames` holds just the names
      // for easy sorting and filtering.
      const trailLayers = {};
      const trailNames = [];

      /**
       * Fetch the GeoJSON file from the server.  For Wix embedding, we use the
       * raw GitHub URL to load the GeoJSON file from the repository.
       * This ensures the file loads correctly regardless of where the HTML is embedded.
       */
      async function loadGeoJSON() {
        try {
          // Use raw GitHub URL for the GeoJSON file
          const response = await fetch('https://raw.githubusercontent.com/natesobol/WMNF-Trails-API/main/merged_trails.geojson');
          if (!response.ok) {
            throw new Error(`HTTP ${response.status} ‚Äì ${response.statusText}`);
          }
          const data = await response.json();
          return data;
        } catch (err) {
          console.error('Failed to load GeoJSON:', err);
          alert('Error loading trail data.  Please check the console for details.');
          return null;
        }
      }

      // Helper function to highlight a single trail layer.  Resets all others
      // back to the default style before applying a highlighted style to the
      // selected trail.
      function highlightLayer(targetLayer) {
        Object.values(trailLayers).forEach(({ layer }) => {
          layer.setStyle({ color: '#3388ff', weight: 3 });
        });
        targetLayer.setStyle({ color: '#e74c3c', weight: 5 });
      }

      /**
       * Populate the map with GeoJSON features.  Each feature becomes a
       * clickable polyline on the map.  When clicked, the trail is highlighted
       * and the map view zooms to its bounds.  The trail name is used
       * as a key in the `trailLayers` object for quick lookup later.
       *
       * @param {Object} geoData The GeoJSON FeatureCollection to display
       */
      function addTrailsToMap(geoData) {
        L.geoJSON(geoData, {
          style: function(feature) {
            // Default line styling.  You can change the color or weight here.
            return { color: '#3388ff', weight: 3 };
          },
          onEachFeature: function(feature, layer) {
            const name = feature.properties && feature.properties.name
              ? feature.properties.name
              : 'Unnamed trail';
            // Store reference to this layer and its original feature
            trailLayers[name] = { layer: layer, feature: feature };
            trailNames.push(name);
            // Bind a popup showing the trail name.  When the line is clicked
            // the popup appears.  You can add more content here (length, notes, etc.).
            layer.bindPopup(`<strong>${name}</strong>`);
            // Handle click on the map line.  Highlight and zoom.
            layer.on('click', function() {
              highlightLayer(layer);
              map.fitBounds(layer.getBounds(), { maxZoom: 14, animate: true });
              layer.openPopup();
            });
          }
        }).addTo(map);
      }

      /**
       * Render the list of trails in the sidebar.  The list is filtered by
       * the search input and sorted according to the dropdown.  Each item
       * becomes clickable; clicking will highlight and pan to the trail.
       */
      function renderTrailList() {
        const listElement = document.getElementById('trailList');
        const searchQuery = document.getElementById('searchInput').value.trim().toLowerCase();
        const sortOrder = document.getElementById('sortSelect').value;
        // Filter names based on the search query
        let filteredNames = trailNames.filter(name => name.toLowerCase().includes(searchQuery));
        // Sort the names alphabetically ascending or descending
        filteredNames.sort((a, b) => {
          return sortOrder === 'za' ? b.localeCompare(a) : a.localeCompare(b);
        });
        // Clear the existing list
        listElement.innerHTML = '';
        
        // Show empty state if no results
        if (filteredNames.length === 0) {
          const emptyMsg = document.createElement('div');
          emptyMsg.className = 'empty-state';
          emptyMsg.textContent = searchQuery 
            ? 'No trails found. Try a different search.' 
            : 'No trails available.';
          listElement.parentElement.appendChild(emptyMsg);
          return;
        }
        
        // Populate list items
        filteredNames.forEach(name => {
          const li = document.createElement('li');
          li.textContent = name;
          // When a list item is clicked, highlight and pan to the trail
          li.addEventListener('click', function() {
            const info = trailLayers[name];
            if (info) {
              highlightLayer(info.layer);
              map.fitBounds(info.layer.getBounds(), { maxZoom: 14, animate: true });
              info.layer.openPopup();
              // Mark the clicked list item as active
              document.querySelectorAll('#trailList li').forEach(el => el.classList.remove('active'));
              this.classList.add('active');
            }
          });
          listElement.appendChild(li);
        });
      }

      // Load the GeoJSON and initialize the map/list.  After the data is loaded
      // we add trails to the map and render the list.  Bind event listeners
      // for search and sort controls.
      const geoData = await loadGeoJSON();
      if (!geoData) return;
      addTrailsToMap(geoData);
      renderTrailList();

      // Re‚Äërender the list whenever search input or sort order changes
      document.getElementById('searchInput').addEventListener('input', renderTrailList);
      document.getElementById('sortSelect').addEventListener('change', renderTrailList);
    })();
  </script>